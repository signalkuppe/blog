{# Post layout, extends cover #}
{% extends "layouts/_layoutCover.njk" %}
{% import "macros.njk" as macro %}
{% set dateSlug %}{{ date | formatDate('DDMMYY') }}{% endset %}
{% set postCoverId %}blog/covers/{{ dateSlug }}{% endset %}
{% set postGpx %}blog/downloads/{{ dateSlug }}.zip{% endset %}
{% set postKml %}blog/downloads/{{ dateSlug }}.kml{% endset %}
{% set author %}{% info 'twitter' %}{% endset %}
  {% block head %}
  {{ macro.socialMeta(title, description, postCoverId) }}
  {{ macro.canonical(page.url) }}
  {{ macro.metaTitle(title, info.slogan) }}
  <link rel="prefetch" href="{{ macro.coverImage(postCoverId, version, crop)  }}">
  <link rel="preconnect" href="https://res.cloudinary.com">
  {% endblock %}
  <body>
    {% block header %}
      <header>
        {{ macro.navigation(activeSection = 'blog') }}
      </header>
    {% endblock %}

    {% block cover %}
    {% call macro.cover(date, title, caption) %}
    <img 
      src="{{ macro.coverImage(postCoverId, version, crop, lazyPlaceholder = true)  }}"
      data-src="{{ macro.coverImage(postCoverId, version, crop)  }}" 
      alt="{{ caption }}" 
      class="lazyImg" />
    {% endcall %}
    {% endblock %}

    {% block content %}
    <article itemscope itemtype="http://schema.org/Article">
      {% call macro.contentHeader(title) %}
      <time datetime="{{ date | formatDate('YYYY-MM-DD') }}" itemprop="datePublished">{{ date | formatDate('DD MMMM YYYY') }}</time>
      <span itemprop="author" itemscope itemtype="http://schema.org/Person"  class="u-srOnly">
        <span itemprop="name">{{ author }}</span>
      </span>
      {% endcall %}
      <section itemprop="articleBody">{{ content | safe }}</section>
      <footer>
      {{ macro.prevNext(collections.posts, page.url) }}
      </footer>
    </article>
    {% endblock %}

    {% block complementary %}
    <aside>
      
      <div class="u-mb-4">
        <h3 class="u-mb-1">Galleria fotografica</h3>
        {{ macro.imageGallery(galleries[dateSlug]) }}
      </div>

      {% if gps %}
      <div class="u-mb-4">
        <h3 class="u-mb-1">Scarica le tracce gps</h3>
        {{ macro.gpsTracks(postGpx, postKml) }}
      </div>
      {% endif %}

      <div class="u-mb-4">
        <h3 class="u-mb-1">Condividi</h3>
        {{ macro.share(page.url, title, description, author) }}
      </div>

      <p>Vuoi rimanere aggiornato sui nuovi post? <strong><a href="http://eepurl.com/dgiWQH"><br>Iscriviti alla newsletter</a></strong></p>
    </aside>
    {% endblock %}

    {% block footer %}
    {{ macro.footer() }}
    {% endblock %}

    {% block scripts %}
    <script src="/node_modules/pace-progress/pace.js"></script>
    <script src="/node_modules/stickybits/dist/stickybits.js"></script>
    <script src="/node_modules/baguettebox.js/dist/baguetteBox.js"></script>
    <script src="/node_modules/vanilla-lazyload/dist/lazyload.js"></script>
    <script src="/node_modules/smooth-scroll/dist/smooth-scroll.js"></script>
    <script src="/js/smoothScroll.js"></script>
    <script src="/js/currentYear.js"></script>
    <script src="/js/menu.js"></script>
    <script src="/js/contentHeader.js"></script>
    <script src="/js/postGallery.js"></script>
    <script src="/js/lazyImages.js"></script>
    {% endblock %}
    
  </body>
</html>

