{# 
# Social media meta tags
# @param {string} title  - The page title
# @param {string} description  - The page description
# @param {string} image  - The page cloudinary image id
# @param {string} twitterCard  - The type of twitter card (default = summary)
# @param {string} ogType - The open graph type (default = article)
#}

{% macro socialMeta(title, description, image, twitterCard='summary', ogType='article') %}
<meta name="description" content="{{ description }}">
<meta name="twitter:card" content="{{ twitterCard }}" />
<meta name="twitter:site" content="{% info 'twitter' %}" />
<meta name="twitter:creator" content="{% info 'twitter' %}" />
<meta property="og:site_name" content="{% info 'name' %}" />
<meta name="twitter:title" content="{{ title }} "/>
<meta property="og:title" content="{{ title }}" />
<meta property="og:type" content="{{ ogType }}" />
<meta property="og:image" content="{{ cloudinaryImageUrl(image, 'w_200,h_200,c_fill,f_auto,q_auto,g_center') }}" />
<meta property="og:description" content="{{ description }}" />
{% endmacro %}


{# 
# favicons
#}

{% macro favicons() %}
<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#000000">
<meta name="theme-color" content="#ffffff">
{% endmacro %}

{# 
# Common meta tags
#}

{% macro commonMeta () %}
<meta charset="utf-8">
<meta name="robots" content="noindex">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
{% endmacro %}

{# 
# Canonical meta tags
# @param {string} url - The page ulr
#}

{% macro canonical(pageUrl) %}
<link rel="canonical" href="{% info 'baseUrl' %}{{ pageUrl }}">
{% endmacro %}


{# 
# Meta title
# @param {string} title - The title
# @param {string} slogan - The slogan adter the pipe
#}

{% macro metaTitle(title, slogan) %}
<title>{{ title }} | {{ slogan }}</title>
{% endmacro %}

{# 
# Document type
#}

{% macro docType() %}
<!doctype html>
{% endmacro %}

{# 
# html tag
#}
{% macro htmlTag() %}<html lang="it">{% endmacro %}

{# 
# Site css file
#}

{% macro css() %}
<link href="https://fonts.googleapis.com/css?family=PT+Sans+Narrow:700,400|PT+Sans:400,400i,700|PT+Serif:700,400&display=swap" rel="stylesheet">
<link href="/css/index.css" rel="stylesheet" media="screen">
<link href="/css/print.css" rel="stylesheet" media="print">
{% endmacro %}

{# 
# Site header
# @param {string} activeSection - The active section
#}

{% macro navigation(activeSection) %}
{% set siteNameTag = 'span' %}
{% if activeSection == 'front' %}
{% set siteNameTag = 'h1' %}
{% endif %}
<header class="c-navigation">
  <h2 class="u-srOnly">Menu</h2>
  <nav>
    <ul class="c-navigation-menu">
      <li><a href="/" title="Torna alla pagina iniziale"{% if activeSection == 'front' %} class="is-active"{% endif %}>Home</a></li>
      <li><a href="/blog" title="Elenco completo dei post"{% if activeSection == 'blog' %} class="is-active"{% endif %}>Blog</a></li>
      <li>
        <a href="/" title="Torna alla pagina iniziale">
          <{{ siteNameTag }} class="c-navigation-siteName">{% info 'name' %}</{{ siteNameTag }}>
        </a>
      </li>
      <li><a href="/foto" title="Il mio portfolio fotografico">Foto</a></li>
      <li><a href="/info" title="Informazioni sullâ€™autore">Info</a></li>
    </ul>
  </nav>
</header>
{% endmacro %}

{# 
# Cloudinary image url
# @param {string} id  - The image id
# @param {string} transformation - The transformation to apply
# @param {string} version - The image version (to bypass cloudinary's cdn cache)
#}

{%- macro cloudinaryImageUrl(id, transformation, version) -%}
https://res.cloudinary.com/{% info 'cloudinaryCloudName' %}/image/upload/{{ transformation }}{% if version %}/{{ version }}{% endif %}/{{ id }}
{%- endmacro -%}


{# 
# Cloudinary raw url
# @param {string} id  - The file id
#}

{% macro cloudinaryRawUrl(id) %}https://res.cloudinary.com/{% info 'cloudinaryCloudName' %}/raw/upload/{{ id }}{% endmacro %}


{# 
# Cover image
# @param {String} coverId  - the cloudinary image id
# @param {String} coverVersion  - the cloudinary image version
#}

{%- macro coverImage(coverId, coverVersion) -%}
{{ cloudinaryImageUrl(coverId, 'w_1920,h_1282,c_fill,f_auto,q_auto', coverVersion) }}
{%- endmacro -%}

{# 
# Cover
# @param {String} date  - the caption date
# @param {String} title  - the caption title
# @param {String} description  - the caption description
#}

{%- macro cover(date, title, description) -%}
<figure class="c-cover">
  {{ caller() }}
  <figcaption class="c-cover-caption">
    {% if date %}
    <time datetime="{{ date | formatDate('YYYY-MM-DD') }}" class="c-cover-date">{{ date | formatDate('DD MMMM YYYY') }}</time>
    {% endif %}
    <div class="c-cover-title">{{ title }}</div>
    <span class="c-cover-description">{{ description }}</span>
  </figcaption>
</figure>
{%- endmacro -%}


{# 
# Page header
# @param {String} title  - the page title
# @param {Boolean} hideOnPortrait  - hide or not on portrait screens
#}

{% macro contentHeader(title, hideOnPortrait) %}
<header id="contentHeader" class="c-contentHeader{% if hideOnPortrait %} c-contentHeader--hideOnPortrait{% endif %}">
  <h1 class="c-contentHeader-title">{{ title | wrapFirstChar | safe }}</h1>
  {{ caller() }}
</header>
{% endmacro %}

{# 
# Post gps tracks
# @param {String} postGpx  - the post gpx public_id
# @param {String} postKml  - the post kml public_id
#}

{% macro gpsTracks(postGpsTracks) %}
<ul>
  {% for track in postGpsTracks %}
  <li class="u-mr-05 u-inline-block">
    <a class="c-button" href="{{ cloudinaryRawUrl(track.id) }}" title="Scarica la traccia in formato .{{ track.type }}">{% include 'icons/download.njk' %} Traccia .{{ track.type }}</a>
  </li>
  {% endfor %}
</ul>
{% endmacro %}

{# 
# Post image gallery
# @param {Array} photos  - an array of photos on cloudinary
#}

{% macro imageGallery(photos) %}
<div class="c-imageGallery">
  <h3 class="c-imageGallery-title">Galleria fotografica</h3>
  <ul class="c-imageGallery-grid">
    {% for photo in photos  %}
    <li class="c-imageGallery-item">
      <a href="{{ cloudinaryImageUrl(photo.id) }}" title="{{ photo.title }}">
        <img 
          data-src="{{ cloudinaryImageUrl(photo.id, 'w_800,c_fill,f_auto,q_auto') }}" 
          alt="{{ photo.alt }}" 
          class="lazyImg" />
      </a>
    </li>                                                              
    {% endfor %}
  </ul>
</div>
{% endmacro %}

{# 
# Page social share
# @param {String} url  - the page url
# @param {String} title  - the page title
# @param {String} description  - the page description
# @param {String} author  - the page author
#}

{% macro share(url, title, description, author) %}
<ul>
  <li class="u-mr-1 u-inline-block">
    <a 
      href="https://www.facebook.com/sharer/sharer.php?u={{ url | urlencode }}" 
      title="Condividi su Facebook" 
      target="_blank"
      rel="noopener"
      class="c-iconButton"
      onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&quote=' + encodeURIComponent(document.URL)); return false;">
      {% include 'icons/facebook.njk' %}
    </a>
  </li>
  <li class="u-mr-1 u-inline-block">
    <a href="https://twitter.com/intent/tweet?source={{ url | urlencode }}&text={{ description| urlencode }}&via={{ author }}" 
      target="_blank" 
      rel="noopener"
      title="Condividi su Twitter" 
      class="c-iconButton"
      onclick="window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(document.title) + ':%20'  + encodeURIComponent(document.URL)); return false;">
      {% include 'icons/twitter.njk' %}
    </a>
  </li>
  <li class="u-mr-1 u-inline-block">
    <a href="mailto:?subject={{ title | urlencode }}&body={{ description | urlencode }}" 
        target="_blank" 
        rel="noopener"
        title="Condividi via mail"
        class="c-iconButton"
        onclick="window.open('mailto:?subject=' + encodeURIComponent(document.title) + '&body=' +  encodeURIComponent(document.URL)); return false;">
        {% include 'icons/mail.njk' %}
    </a>
  </li>
  <li class="u-inline-block">
    <a href="" 
        title="Stampa" 
        class="c-iconButton"
        onclick="window.print()">
        {% include 'icons/print.njk' %}
    </a>
  </li>
</ul>
{% endmacro %}

{# 
# Site footer
#}

{% macro footer() %}
<footer class="c-footer">
  <span id="currentYear"></span> - <strong>Signalkuppe</strong> | contenuti pubblicati sotto licenza <a href="https://choosealicense.com/licenses/agpl-3.0/" title="Leggi la licenza" target="_blank" rel="noopener">GNU AGPLv3</a> | <a href="/info">Info & contatti</a>
  | <a href="{% info 'facebookSite' %}" title="Seguimi su facebook">Facebook</a> | <a href="{% info 'twitterSite' %}" title="Seguimi su facebook">Twitter</a> | <a href="{% info 'instagramSite' %}" title="Seguimi su facebook">Instagram</a>
  <span class="c-footer-topLink"> | {% include 'icons/arrow-up.njk' %}<a href="#top">Torna in cima</a></span>
</footer>
{% endmacro %}


{# 
# Prev and next post
# @param {Array} collection - the post collection
# @param {String} pageUrl - the current page url
#}

{% macro prevNext(collection, pageUrl ) %}
{% set currentItemIndex = 0 %}
{% set countOfItems = collection.length %}
{% for item in collection %}
  {% if item.url == pageUrl%}
  	{% set currentItemIndex = loop.index0 %}
	{% endif %}
{% endfor %}
{% set NextItemIndex = currentItemIndex - 1  %}
{% set PrevItemIndex = currentItemIndex + 1  %}
{% set NextItem = collection[NextItemIndex] %}
{% set PrevItem = collection[PrevItemIndex] %}
<dl>
  {% if NextItem %}
  <dt class="u-mb-1">Post successivo</dt>
  <dd><time datetime="{{ NextItem.data.date | formatDate('YYYY-MM-DD') }}">{{ NextItem.data.date | formatDate('DD MMMM YYYY') }}</time><br/><a href="{{ NextItem.url | url }}">{{ NextItem.data.title }}</a></dd>
  {% endif %}
  {% if PrevItem %}
  <dt class="u-mb-1">Post precedente</dt>
  <dd><time datetime="{{ PrevItem.data.date | formatDate('YYYY-MM-DD') }}">{{ PrevItem.data.date | formatDate('DD MMMM YYYY') }}</time><br /><a href="{{ PrevItem.url | url }}">{{ PrevItem.data.title }}</a></dd>
  {% endif %}
</dl>
{% endmacro %}


{# 
# Post card
# @param {Object} post - the post data
#}

{% macro card(post) %}
  {% set dateSlug %}{{ post.data.date | formatDate('DDMMYY') }}{% endset %}
  <article class="c-card" itemscope itemtype="http://schema.org/Article">
    <figure class="c-card-image">
      <img 
        class="lazyImg"
        data-src="{{ cloudinaryImageUrl(post.data.cover.id, 'w_500,h_333,c_fill,f_auto,q_60') }}" 
        alt="{{ post.data.title }}" />
    </figure>
    <div class="c-card-body">
      <header class="c-card-header">
        <time datetime="{{ post.data.date | formatDate('YYYY-MM-DD') }}" itemprop="datePublished">{{ post.data.date | formatDate('DD MMMM YYYY') }}</time>
        <h2 class="c-card-title">{{ post.data.title }}</h2>
      </header>
      <p>{{ post.data.description }}</p>
    </div>
  </article>
{% endmacro %}