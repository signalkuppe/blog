---
import PhotoPage from "../components/PhotoPage.astro";
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('posts');

  const pages = [];

  for (const post of posts) {
    if (post.data.gallery && post.data.gallery.length > 0) {
      const postPhotos = post.data.gallery;
      postPhotos.forEach((photo, i) => {
        pages.push({
          params: { postPhoto: `${post.slug}/photo-${i + 1}` },
          props: {
            photo,
            post,
            photoIndex: i,
            prev: postPhotos[i - 1],
            next: postPhotos[i + 1],
          },
        });
      });
    }
  }

  return pages;
}

interface Props {
  photo: any;
  post: any;
  photoIndex: number;
  prev: any;
  next: any;
}

const { photo, post, photoIndex, prev, next } = Astro.props;
---

<PhotoPage
  photo={photo}
  backLink={`/${post.slug}#post-gallery`}
  backLinkText={post.data.title}
  nextLink={next ? `/${post.slug}/photo-${photoIndex + 2}` : null}
  prevLink={prev ? `/${post.slug}/photo-${photoIndex}` : null}
/>
